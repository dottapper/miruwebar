# Firebase APIキー制限設定 - ステップバイステップガイド

## 📍 Google Cloud Consoleでの操作手順

### ステップ1: ログインとプロジェクト確認

1. **ログイン**
   - 右上の「Sign in」からログイン
   - Firebaseプロジェクト「miruwebar」にアクセスできるアカウントでログイン

2. **プロジェクトの確認**
   - 画面上部のプロジェクト選択ドロップダウンを確認
   - 「miruwebar」が選択されていることを確認
   - 選択されていない場合は、「miruwebar」を選択

### ステップ2: APIキーを探す

1. **認証情報ページを確認**
   - 左メニューから「APIとサービス」→「認証情報」をクリック（既にこのページにいる場合はそのまま）

2. **APIキーを検索**
   - ページ内の検索ボックスに `AIzaSyCo3JP` と入力
   - または、「APIキー」というセクションを探す
   - 公開されたAPIキー（`AIzaSyCo3JPf7ohXf09fyLwwAXKfv-waV-GG3qE`）を探す

3. **見つからない場合**
   - 「すべての認証情報を表示」をクリック
   - フィルターを解除
   - ページを下にスクロールして確認

### ステップ3: APIキーを編集

1. **APIキーをクリック**
   - 見つかったAPIキーをクリック
   - 編集画面が開きます

2. **「アプリケーションの制限」を設定**
   - 「アプリケーションの制限」セクションを探す
   - 「なし」から「HTTPリファラー（ウェブサイト）」に変更
   - 「ウェブサイトの制限」セクションが表示される
   - 「項目を追加」をクリック
   - 許可するドメインを追加：
     ```
     localhost:*
     127.0.0.1:*
     ```
   - 本番環境のドメインがある場合は追加：
     ```
     your-domain.com/*
     https://your-domain.com/*
     ```

3. **「APIの制限」を設定**
   - 「APIの制限」セクションを探す
   - 「なし」から「キーを制限」に変更
   - 「APIを選択」をクリック
   - 使用するAPIのみを選択：
     - ✅ Firebase Storage API
     - ✅ Firebase Realtime Database API（使用している場合）
     - ✅ その他、実際に使用しているFirebase APIのみ
   - 選択後、「OK」をクリック

### ステップ4: 保存

1. **変更を保存**
   - ページ下部の「保存」ボタンをクリック
   - 確認ダイアログが表示される場合は「保存」を確認

2. **反映を確認**
   - 変更が反映されるまで数分かかる場合があります
   - ページをリロードして、設定が保存されているか確認

## 🔍 画面の見つけ方

### 認証情報ページの見た目

```
Google Cloud Platform
┌─────────────────────────────────────┐
│ プロジェクト: miruwebar  ▼         │
├─────────────────────────────────────┤
│ 左メニュー                          │
│ ├─ APIとサービス                    │
│ │  └─ 認証情報 ← ここをクリック     │
│ ├─ IAMと管理                        │
│ └─ ...                              │
├─────────────────────────────────────┤
│ 認証情報                            │
│                                     │
│ [認証情報を作成 ▼]                  │
│                                     │
│ APIキー                             │
│ ┌─────────────────────────────────┐│
│ │ AIzaSyCo3JPf7ohXf09fyLwwAXKfv... ││ ← これをクリック
│ │ 作成日: 2024-01-01               ││
│ └─────────────────────────────────┘│
│                                     │
│ OAuth 2.0 クライアント ID          │
│ ...                                 │
└─────────────────────────────────────┘
```

### APIキー編集画面の見た目

```
APIキーの編集
┌─────────────────────────────────────┐
│ 名前: [APIキー名]                    │
│                                     │
│ アプリケーションの制限               │
│ ○ なし                              │
│ ● HTTPリファラー（ウェブサイト）      │
│                                     │
│ ウェブサイトの制限                   │
│ ┌─────────────────────────────────┐│
│ │ localhost:*                      ││
│ │ 127.0.0.1:*                      ││
│ │ [項目を追加]                      ││
│ └─────────────────────────────────┘│
│                                     │
│ APIの制限                            │
│ ○ なし                              │
│ ● キーを制限                        │
│                                     │
│ 制限するAPI:                        │
│ ┌─────────────────────────────────┐│
│ │ ☑ Firebase Storage API          ││
│ │ ☐ Firebase Realtime Database... ││
│ │ ☐ ...                            ││
│ └─────────────────────────────────┘│
│                                     │
│ [キャンセル]  [保存] ← ここをクリック│
└─────────────────────────────────────┘
```

## ⚠️ 注意事項

1. **開発環境での動作確認**
   - 制限を設定した後、ローカル開発環境（`localhost:3000`など）で動作確認
   - エラーが出る場合は、許可するドメインに追加

2. **本番環境のドメイン**
   - 本番環境のドメインがある場合は、必ず追加
   - ワイルドカード（`*`）を使用してサブドメインも許可可能

3. **APIの選択**
   - 使用していないAPIは選択しない
   - 必要最小限のAPIのみを選択することで、セキュリティを強化

## 🆘 トラブルシューティング

### APIキーが見つからない

1. **プロジェクトが正しいか確認**
   - 画面上部のプロジェクト選択で「miruwebar」を確認

2. **別のアカウントでログインしていないか確認**
   - 右上のアカウントアイコンを確認
   - Firebase Consoleと同じアカウントか確認

3. **検索を試す**
   - 検索ボックスに `AIzaSy` と入力
   - 部分一致で検索される

### 保存できない

1. **権限を確認**
   - プロジェクトの所有者または編集者権限が必要
   - 権限がない場合は、プロジェクトの所有者に依頼

2. **ブラウザを確認**
   - ブラウザのキャッシュをクリア
   - 別のブラウザで試す

### 設定後にエラーが出る

1. **許可するドメインを確認**
   - 開発環境のURL（`localhost:3000`など）が許可されているか確認
   - 必要に応じて追加

2. **APIの選択を確認**
   - 必要なAPIが選択されているか確認
   - 使用しているAPIがすべて選択されているか確認

## 📝 完了後の確認

設定が完了したら、以下を確認してください：

1. ✅ APIキーに制限が設定されている
2. ✅ 開発環境でアプリが動作する
3. ✅ 本番環境のドメインが許可されている（該当する場合）
4. ✅ 必要なAPIが選択されている

## 🔗 参考リンク

- [Google Cloud Console - 認証情報](https://console.cloud.google.com/apis/credentials)
- [APIキーの制限設定](https://cloud.google.com/docs/authentication/api-keys#restricting_apis)
