# ライブラリバージョン確認レポート

**確認日**: 2025-12-30  
**目的**: QR コードスキャン →3D 表示の仕様に対応したライブラリが使用されているか確認

---

## 📋 仕様要件

1. **QR コード生成**: スマホでスキャン可能な QR コードを生成
2. **3D モデル表示**: 設定画面で配置した 3D モデル（GLB 形式）を表示
3. **AR 表示**: マーカー検出で 3D モデルを AR 空間に配置

---

## 🔍 現在のライブラリ状況

### ✅ QR コード生成ライブラリ

| ライブラリ | 現在のバージョン | 最新バージョン | 状態        |
| ---------- | ---------------- | -------------- | ----------- |
| `qrcode`   | **1.5.4**        | **1.5.4**      | ✅ **最新** |

**使用箇所**:

- `src/utils/qrcode-loader.js` - QR コード生成の遅延読み込み
- `src/components/ui.js` - QR コードモーダル表示
- `src/views/editor.js` - QR コード発行ボタン

**機能確認**:

- ✅ `QRCode.toCanvas()` で Canvas に QR コードを描画
- ✅ プロジェクト URL を QR コード化
- ✅ ダウンロード機能あり

**結論**: **更新不要** - 最新版を使用中

---

### ⚠️ Three.js（3D レンダリング）

| ライブラリ | 現在のバージョン | 最新バージョン | 状態            |
| ---------- | ---------------- | -------------- | --------------- |
| `three`    | **0.165.0**      | **0.182.0**    | ⚠️ **更新可能** |

**使用箇所**:

- `src/components/ar/marker-ar.js` - マーカー AR 実装
- `src/components/ar/webxr-ar.js` - WebXR AR 実装
- `src/views/ar-viewer.js` - AR ビューア統合
- `src/components/arViewer.js` - 3D ビューア

**機能確認**:

- ✅ GLTFLoader で GLB/GLTF ファイルを読み込み
- ✅ 3D モデルの配置・表示
- ✅ カメラ・レンダラー設定
- ✅ アニメーション対応

**バージョン差の影響**:

- Three.js 0.165.0 → 0.182.0 の変更点:
  - バグ修正
  - パフォーマンス改善
  - 新機能追加（ただし、現在の使用機能には影響なし）

**推奨**:

- **現状維持で問題なし** - 0.165.0 でも仕様要件を満たしている
- 更新する場合は、AR.js との互換性を確認が必要

---

### ⚠️ AR.js（マーカー AR 検出）

| ライブラリ                 | 現在のバージョン     | 最新バージョン | 状態          |
| -------------------------- | -------------------- | -------------- | ------------- |
| `ar-threex.js`             | **ローカルファイル** | **不明**       | ⚠️ **要確認** |
| `@ar-js-org/ar.js-threejs` | **0.3.2**            | **0.3.2**      | ✅ **最新**   |

**使用箇所**:

- `public/arjs/ar-threex.js` - ローカルファイル（実際に使用中）
- `index.html` - `<script src="/arjs/ar-threex.js"></script>`
- `src/components/ar/marker-ar.js` - AR.js API を使用

**機能確認**:

- ✅ `THREEx.ArToolkitSource` - カメラ映像取得
- ✅ `THREEx.ArToolkitContext` - マーカー検出
- ✅ `THREEx.ArMarkerControls` - マーカーコントロール
- ✅ カスタムマーカー画像の `.patt` 変換対応

**問題点**:

- `package.json` に `@ar-js-org/ar.js-threejs` が依存関係にあるが、実際には使用されていない
- ローカルファイル `public/arjs/ar-threex.js` を使用しているため、バージョン管理が不明確

**推奨**:

- **現状維持で問題なし** - 現在の実装で仕様要件を満たしている
- 将来的には npm パッケージに移行を検討

---

### ✅ GLTFLoader（3D モデル読み込み）

| ライブラリ                                 | 現在のバージョン        | 最新バージョン          | 状態        |
| ------------------------------------------ | ----------------------- | ----------------------- | ----------- |
| `three/examples/jsm/loaders/GLTFLoader.js` | **Three.js に含まれる** | **Three.js に含まれる** | ✅ **最新** |

**使用箇所**:

- `src/components/ar/marker-ar.js` - 動的インポート
- `src/components/ar/webxr-ar.js` - 直接インポート
- `src/views/ar-viewer.js` - 動的インポート

**機能確認**:

- ✅ GLB/GLTF ファイルの読み込み
- ✅ アニメーション対応
- ✅ テクスチャ・マテリアル対応

**結論**: **更新不要** - Three.js に含まれており、Three.js のバージョンに依存

---

## 📊 仕様適合性チェック

| 要件              | ライブラリ              | 状態        | 備考                 |
| ----------------- | ----------------------- | ----------- | -------------------- |
| QR コード生成     | `qrcode` 1.5.4          | ✅ **対応** | 最新版使用中         |
| 3D モデル読み込み | `GLTFLoader` (Three.js) | ✅ **対応** | GLB/GLTF 対応        |
| 3D モデル表示     | `Three.js` 0.165.0      | ✅ **対応** | レンダリング正常     |
| マーカー検出      | `AR.js` (ar-threex.js)  | ✅ **対応** | カスタムマーカー対応 |
| AR 空間配置       | `AR.js` + `Three.js`    | ✅ **対応** | マーカー上に 3D 配置 |

---

## 🎯 結論

### ✅ 現状維持で問題なし

**理由**:

1. **QR コード生成**: 最新版（1.5.4）を使用中
2. **3D 表示**: Three.js 0.165.0 で仕様要件を満たしている
3. **AR 表示**: AR.js でマーカー検出・3D 配置が正常に動作

### ⚠️ 任意の更新候補

**Three.js 0.165.0 → 0.182.0**:

- メリット: バグ修正、パフォーマンス改善
- デメリット: AR.js との互換性確認が必要
- 推奨: **現状維持**（問題がなければ更新不要）

### 📝 改善提案（将来）

1. **AR.js のバージョン管理**:

   - ローカルファイル `public/arjs/ar-threex.js` のバージョンを明記
   - または npm パッケージ `@ar-js-org/ar.js-threejs` に移行

2. **依存関係の整理**:
   - `package.json` に記載されているが使用されていないパッケージを削除
   - または実際に使用するパッケージに統一

---

## 🔧 更新が必要な場合の手順

### Three.js を更新する場合

```bash
# 1. バージョン確認
npm view three version

# 2. package.json を更新
# "three": "0.182.0"

# 3. インストール
npm install

# 4. AR.jsとの互換性テスト
# - マーカー検出が正常に動作するか
# - 3Dモデルの表示が正常か
# - カメラ映像の表示が正常か
```

### AR.js を更新する場合

```bash
# 1. 最新の ar-threex.js をダウンロード
# https://github.com/AR-js-org/AR.js/releases

# 2. public/arjs/ar-threex.js を置き換え

# 3. 互換性テスト
# - Three.js との互換性
# - カスタムマーカーの動作
```

---

## 📚 参考情報

- [Three.js 公式ドキュメント](https://threejs.org/docs/)
- [AR.js GitHub](https://github.com/AR-js-org/AR.js)
- [QRCode npm](https://www.npmjs.com/package/qrcode)

