<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“± HIROãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º - ã‚¹ã‚­ãƒ£ãƒ³ç”¨</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            user-select: none;
        }
        
        .container {
            text-align: center;
            padding: 20px;
        }
        
        .marker-display {
            background: white;
            border: 8px solid #000;
            border-radius: 16px;
            padding: 20px;
            margin: 20px auto;
            box-shadow: 0 4px 20px rgba(255,255,255,0.3);
        }
        
        .marker-image {
            display: block;
            width: 300px;
            height: 300px;
            border: 3px solid #333;
            background: white;
        }
        
        @media (max-width: 480px) {
            .marker-image {
                width: 250px;
                height: 250px;
            }
        }
        
        .instructions {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            max-width: 400px;
        }
        
        .brightness-controls {
            margin: 20px 0;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            margin: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .fullscreen-btn {
            background: #28a745;
        }
        
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: rgba(0,150,255,0.2);
        }
        
        .hidden {
            display: none;
        }
        
        /* ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¢ãƒ¼ãƒ‰ */
        .fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .fullscreen .marker-image {
            width: 80vmin;
            height: 80vmin;
            max-width: 400px;
            max-height: 400px;
        }
        
        .close-fullscreen {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            z-index: 10000;
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <h1>ğŸ“± HIROãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º</h1>
        
        <div class="status" id="status">
            ãƒãƒ¼ã‚«ãƒ¼ç”»åƒã‚’èª­ã¿è¾¼ã¿ä¸­...
        </div>
        
        <div class="marker-display">
            <img class="marker-image" id="markerImage" alt="HIROãƒãƒ¼ã‚«ãƒ¼">
        </div>
        
        <div class="instructions">
            <h3>ğŸ¯ ä½¿ã„æ–¹</h3>
            <p><strong>åˆ¥ã®ãƒ‡ãƒã‚¤ã‚¹</strong>ã§ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã«ã‚¢ã‚¯ã‚»ã‚¹:</p>
            <p style="background: rgba(0,0,0,0.3); padding: 8px; border-radius: 4px; word-break: break-all; font-size: 12px;">
                <strong>https://192.168.0.121:3000/marker-test-improved.html</strong>
            </p>
            <p>ã“ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚«ãƒ¡ãƒ©ã«å‘ã‘ã¦ç·‘ã®ã‚­ãƒ¥ãƒ¼ãƒ–ã‚’ç¢ºèª</p>
        </div>
        
        <div class="brightness-controls">
            <button onclick="adjustBrightness(-10)">ğŸ”… æš—ã</button>
            <button onclick="adjustBrightness(10)">ğŸ”† æ˜ã‚‹ã</button>
            <button onclick="toggleFullscreen()" class="fullscreen-btn">ğŸ“± ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³</button>
            <button onclick="downloadMarker()">ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
        </div>
        
        <div class="instructions">
            <h4>ğŸ’¡ èªè­˜ã‚’æ”¹å–„ã™ã‚‹ã‚³ãƒ„</h4>
            <ul style="text-align: left;">
                <li>ç”»é¢ã®æ˜ã‚‹ã•ã‚’æœ€å¤§ã«ã™ã‚‹</li>
                <li>ãƒãƒ¼ã‚«ãƒ¼ã‚’æ­£é¢ã‹ã‚‰è¦‹ã‚‹</li>
                <li>è·é›¢ã‚’30cmç¨‹åº¦ã«ä¿ã¤</li>
                <li>æ‰‹ãƒ–ãƒ¬ã‚’é¿ã‘ã¦ã‚†ã£ãã‚Šå‹•ã‹ã™</li>
                <li>åå°„ã‚’é¿ã‘ã‚‹è§’åº¦ã«ã™ã‚‹</li>
            </ul>
        </div>
    </div>
    
    <!-- ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¢ãƒ¼ãƒ‰ -->
    <div class="fullscreen hidden" id="fullscreenContainer">
        <button class="close-fullscreen" onclick="exitFullscreen()">âœ• é–‰ã˜ã‚‹</button>
        <img class="marker-image" id="fullscreenMarker" alt="HIROãƒãƒ¼ã‚«ãƒ¼ ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³">
    </div>

    <script>
        const statusEl = document.getElementById('status');
        const markerImg = document.getElementById('markerImage');
        const fullscreenContainer = document.getElementById('fullscreenContainer');
        const fullscreenMarker = document.getElementById('fullscreenMarker');
        const mainContainer = document.getElementById('mainContainer');
        
        let brightness = 100;
        
        // HIROãƒãƒ¼ã‚«ãƒ¼ç”»åƒã‚’èª­ã¿è¾¼ã¿
        function loadMarkerImage() {
            const markerUrl = 'https://ar-js-org.github.io/AR.js/data/images/HIRO.jpg';
            
            markerImg.onload = () => {
                statusEl.innerHTML = 'âœ… ãƒãƒ¼ã‚«ãƒ¼ç”»åƒèª­ã¿è¾¼ã¿å®Œäº†ï¼èªè­˜ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚';
                statusEl.style.background = 'rgba(40,167,69,0.3)';
                
                // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ç”¨ã«ã‚‚è¨­å®š
                fullscreenMarker.src = markerUrl;
            };
            
            markerImg.onerror = () => {
                statusEl.innerHTML = 'âŒ ãƒãƒ¼ã‚«ãƒ¼ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç’°å¢ƒã§ã¯å‹•ä½œã—ã¾ã›ã‚“ã€‚';
                statusEl.style.background = 'rgba(220,53,69,0.3)';
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šãƒ­ãƒ¼ã‚«ãƒ«ã§ä»£æ›¿ãƒãƒ¼ã‚«ãƒ¼ã‚’ç”Ÿæˆ
                createFallbackMarker();
            };
            
            markerImg.src = markerUrl;
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šç°¡æ˜“ãƒãƒ¼ã‚«ãƒ¼ç”Ÿæˆ
        function createFallbackMarker() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 300;
            canvas.height = 300;
            
            // ç™½èƒŒæ™¯
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, 300, 300);
            
            // é»’æ 
            ctx.fillStyle = '#000000';
            ctx.fillRect(0, 0, 300, 50);
            ctx.fillRect(0, 0, 50, 300);
            ctx.fillRect(250, 0, 50, 300);
            ctx.fillRect(0, 250, 300, 50);
            
            // å†…éƒ¨ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆHIROãƒãƒ¼ã‚«ãƒ¼é¢¨ï¼‰
            ctx.fillRect(75, 75, 150, 25);
            ctx.fillRect(75, 125, 25, 100);
            ctx.fillRect(200, 125, 25, 100);
            ctx.fillRect(125, 200, 75, 25);
            
            const dataUrl = canvas.toDataURL();
            markerImg.src = dataUrl;
            fullscreenMarker.src = dataUrl;
            
            statusEl.innerHTML = 'âš ï¸ ç°¡æ˜“ãƒãƒ¼ã‚«ãƒ¼ã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚èªè­˜ç²¾åº¦ãŒä½ã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚';
            statusEl.style.background = 'rgba(255,193,7,0.3)';
        }
        
        // æ˜ã‚‹ã•èª¿æ•´
        function adjustBrightness(delta) {
            brightness = Math.max(50, Math.min(150, brightness + delta));
            markerImg.style.filter = `brightness(${brightness}%)`;
            fullscreenMarker.style.filter = `brightness(${brightness}%)`;
            statusEl.innerHTML = `ğŸ”† æ˜ã‚‹ã•: ${brightness}%`;
        }
        
        // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¢ãƒ¼ãƒ‰
        function toggleFullscreen() {
            if (fullscreenContainer.classList.contains('hidden')) {
                // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³è¡¨ç¤º
                fullscreenContainer.classList.remove('hidden');
                mainContainer.style.display = 'none';
                
                // ç”»é¢ã‚’æ˜ã‚‹ãã™ã‚‹
                document.body.style.background = '#ffffff';
                
                // ç”»é¢ã‚¹ãƒªãƒ¼ãƒ—ã‚’é˜²ãï¼ˆå¯èƒ½ã§ã‚ã‚Œã°ï¼‰
                if ('wakeLock' in navigator) {
                    navigator.wakeLock.request('screen').catch(e => {
                        console.log('Wake Lock failed:', e);
                    });
                }
                
                statusEl.innerHTML = 'ğŸ“± ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤ºä¸­';
            }
        }
        
        function exitFullscreen() {
            fullscreenContainer.classList.add('hidden');
            mainContainer.style.display = 'flex';
            document.body.style.background = '#000';
            
            statusEl.innerHTML = 'âœ… ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¢ãƒ¼ãƒ‰çµ‚äº†';
        }
        
        // ãƒãƒ¼ã‚«ãƒ¼ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadMarker() {
            const link = document.createElement('a');
            link.href = 'https://ar-js-org.github.io/AR.js/data/images/HIRO.jpg';
            link.download = 'HIRO-marker.jpg';
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            statusEl.innerHTML = 'ğŸ’¾ ãƒãƒ¼ã‚«ãƒ¼ç”»åƒã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¾ã—ãŸ';
        }
        
        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                exitFullscreen();
            } else if (e.key === 'f' || e.key === 'F') {
                toggleFullscreen();
            } else if (e.key === '+') {
                adjustBrightness(10);
            } else if (e.key === '-') {
                adjustBrightness(-10);
            }
        });
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
        window.addEventListener('load', () => {
            loadMarkerImage();
            
            // ç”»é¢ã®æ˜ã‚‹ã•ã‚’æœ€å¤§ã«ï¼ˆå¯èƒ½ã§ã‚ã‚Œã°ï¼‰
            if ('screen' in navigator && 'orientation' in screen) {
                try {
                    screen.orientation.lock('portrait').catch(() => {});
                } catch (e) {}
            }
        });
        
        // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã§ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³åˆ‡ã‚Šæ›¿ãˆ
        markerImg.addEventListener('click', toggleFullscreen);
        fullscreenMarker.addEventListener('click', exitFullscreen);
    </script>
</body>
</html>