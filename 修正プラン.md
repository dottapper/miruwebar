2025.8.23

### 目的

- 3D 保存/復元の安定化、ローディング画面の永続化、QR 閲覧（スマホ）まで一連の体験を“確実に”動作させる。

### 現状

- プレビューの視点/サイズ差は解消済み（`arViewer.js`修正）。
- 8/20 時点へ戻し、今日の重要修正は反映済み。

### 再プラン（最短で成果 → 堅牢化の順）

1. クイック検証（30 分）

- マーカー/マーカーレスで新規 → 保存 → 再読込の変形復元を確認
- ローディング画面選択の保存/再読込を確認
- QR 生成 → スマホ実機閲覧（同一 LAN）確認

2. 保存基盤の一本化（IndexedDB 優先、localStorage はメタのみ）

- ストレージ層にアダプタを作成（単一 API：get/set/delete/list）
- 既存データの自動移行（起動時 1 回、進捗ログ＋リトライ）
- 変形/アニメ/モデル参照の整合性テストを追加

3. ローディング画面の永続化の固定化

- `selectedScreenId` と必要なパラメータを `project.json` に集約
- 新規/編集/エクスポート/ビューア読込の往復テスト

4. ビューア（#/viewer?src=）の完成度アップ

- ネットワーク/HTTPS/カメラ許可/ミックスドコンテンツ自動診断 UI
- 失敗時の代替テキストと再試行導線（ユーザーフレンドリーな文言）

5. QR/公開フロー

- Local/LAN/Public 切替、URL コピー、QR 再生成
- iOS/Safari ガイド表示（HTTPS 必須・CORS 注意）

6. Export ZIP

- `project.json + assets + viewer.html` を相対パスで出力
- ZIP 内パス検証（ローカルでそのまま開いて動作）

7. パフォーマンス/安定化

- dispose/URL.revokeObjectURL 徹底
- 大型 GLB の読み込み中 UI/キャンセル導線
- 60fps 維持の軽量化（影/後景/ポストプロセス最適化）

8. デバッグ/運用補助

- 診断ページ（既にあるものを整備）と隠しデバッグパネル
- ログレベル統一・ユーザー向けエラー文言統一

9. ドキュメント

- 公開手順・CORS 設定・QR 運用・既知の制約を README へ集約

### 気になるポイント（追加で入れ込み）

- 単位を“1unit=1m”で明文化（UI 表示も m/cm で統一）
- 既存プロジェクトの互換読み込み（欠損キーは安全なデフォルトで補完）
- スマホでの最初の権限ダイアログ誘導（1 タップで許可まで案内）

### 成果物の順序

- まず「保存/復元/QR 表示」が毎回成功する“実用安定版”を最短で切る
- 次に Export ZIP と診断 UI で外部公開まで一気通貫

この順で着手します。最初は「保存の一本化」と「QR 実機確認」から進めますが、開始してよいでしょうか？
